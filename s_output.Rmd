---
title: "Výstup: dokumentace, validace"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
                      comment = "")
source("_targets_packages.R")
options(crayon.enabled = FALSE)
cnf <- config::get()
names(cnf) <- paste0("c_", names(cnf))
list2env(cnf, envir = .GlobalEnv)
```

```{r load targets}
targets::tar_load(sum_quarterly)
targets::tar_load(sum_annual)
targets::tar_load(ef_pub)
targets::tar_load(efs_prv)
targets::tar_load(efs_zop)
targets::tar_load(efs_fin)
targets::tar_load(sum_codebook)
targets::tar_load(efs_tagged)
```

# {.tabset}

## Náhled hlavního výstupu

```{r}
efs_tagged %>% 
  add_op_labels() %>% 
  mutate(oblast_intervence_klimatag_code = case_when(oblast_intervence_klimatag == 0 ~ "none",
                                                     oblast_intervence_klimatag == 0.4 ~ "partial",
                                                     oblast_intervence_klimatag == 1 ~ "full",
                                                     is.na(oblast_intervence_klimatag) ~ "unknown") %>% 
           fct_relevel("full", "partial", "none", "unknown") %>% fct_rev()) %>% 
  group_by(oblast_intervence_klimatag_code) %>% 
  count(op_zkr, wt = fin_vyuct_czv/1e9) %>% 
  ggplot(aes(y = op_zkr, x = n, fill = oblast_intervence_klimatag_code)) +
  scale_fill_manual(values = c(full = "darkgreen", partial = "lightgreen",
                               none = "darkgrey", unknown = "lightgrey"), name = NULL) +
  geom_col() +
  theme_ptrr("x", legend.position = "bottom") +
  labs(title = "Spending by climate tags",
       subtitle = "bn CZK, all spending. Follows official climate tags.")
```


## Dokumentace hlavního výstupu

### Soubory

Vše v `` `r  
c_export_dir` `` ([Github](`r paste0(c_repo_remote, "/tree/master/", c_export_dir)`)) 

- součty po letech: `` `r  
c_export_csv_a` `` / `` `r  
c_export_xlsx_a` ``
- součty po čtvrtletích: `` `r  
c_export_csv_q` `` / `` `r  
c_export_xlsx_q` ``

CSV soubory uzpůsobeny pro Excel (úprava konce řádků) a CEE region (odděleno středníky, desetinná čárka).

### Codebook

```{r codebook}
sum_codebook
```

Zapsáno v `r file.path(c_export_dir, c_export_cdbk)`

## Náhled proměnných

```{r columns}
glimpse(sum_quarterly)
```

## Validace výstupu

IN PROGRESS

```{r}
sum_quarterly %>% 
  count(dt_zop_rok, wt = round(fin_vyuct_czv/1e9, 2)) %>% 
  spread(dt_zop_rok, n)
```
```{r}
sum_quarterly %>% 
  count(source, wt = fin_vyuct_czv)
```

```{r}
efs_fin %>% count(wt = fin_vyuct_czv)
efs_zop %>% count(wt = fin_vyuct_czv)
```

